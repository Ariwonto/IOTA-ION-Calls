(function(e){function t(t){for(var r,i,a=t[0],c=t[1],u=t[2],d=0,f=[];d<a.length;d++)i=a[d],o[i]&&f.push(o[i][0]),o[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(f.length)f.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(r=!1)}r&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={0:0},s=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;s.push([0,1]),n()})({"/ee7":function(e,t,n){"use strict";var r=n("Leqt"),o=n.n(r);o.a},"/lMn":function(e,t,n){},0:function(e,t,n){e.exports=n("Vtdi")},"0Lli":function(e,t,n){"use strict";var r=n("ykFD"),o=n.n(r);o.a},"5v0w":function(e,t,n){},7:function(e,t){},"7aLH":function(e,t,n){},8:function(e,t){},"8QEZ":function(e,t,n){"use strict";var r=n("hS2K"),o=n.n(r);o.a},E47j:function(e,t,n){},H8JV:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="H8JV"},I77X:function(e,t,n){"use strict";var r=n("JxAg"),o=n.n(r);t["default"]=o.a},JxAg:function(e,t,n){n("m5jE"),n("xQ6B"),n("5v0w"),n("R6z1")},LXVK:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view",{key:e.$route.fullPath})],1)},o=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return o})},Leqt:function(e,t,n){},OBwG:function(e,t,n){"use strict";var r=n("tJJL"),o=n.n(r);o.a},OohY:function(e,t,n){"use strict";var r=n("/lMn"),o=n.n(r);o.a},Pf3K:function(e,t,n){"use strict";var r=n("LXVK"),o=n("I77X"),s=(n("f69V"),n("KHd+")),i=Object(s["a"])(o["default"],r["a"],r["b"],!1,null,null,null);t["default"]=i.exports},R6z1:function(e,t,n){},Vtdi:function(e,t,n){"use strict";n.r(t);n("yt8O"),n("VRzm");var r=n("Kw5r"),o=n("Pf3K"),s=n("jE9Z"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return"undefined"===typeof e.user?n("window",[n("name-input",{attrs:{onFinish:e.onSetNickname}})],1):n("call")},a=[],c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"container"},[n("div",{staticClass:"contents"},[e._t("default")],2)])},u=[],l={},d=l,f=(n("rFnw"),n("KHd+")),p=Object(f["a"])(d,c,u,!1,null,"2f287cf2",null),m=p.exports,v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.correctlyLoaded?n("div",[n("div",{staticClass:"full-view"},[n("div",{staticClass:"videos"},[n("user-video",{attrs:{"on-update":e.videoUpdated,name:e.user.name,status:"connected"}},[n("video",{ref:"my_vid"})]),e._l(e.connections,function(t,r){return n("user-video",{attrs:{"on-update":e.videoUpdated,name:t.name,status:t.status}},[n("video",{directives:[{name:"show",rawName:"v-show",value:"connected"===t.status,expression:"val.status === 'connected'"}],ref:"vid:"+r,refInFor:!0})])})],2),0===Object.keys(e.connections).length?n("share-window",{attrs:{url:e.getConnectionUrl()}}):e._e(),n("div",{staticClass:"chat"},[n("text-input",{attrs:{onEnter:e.say,placeholder:Object.keys(e.connections).length>0?"Type a message...":"Waiting for others to appear...",disabled:Object.keys(e.connections).length>0},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1)],1),n("div",{staticClass:"messages"},[n("div",{staticClass:"inner"},e._l(e.messages,function(t){return n("div",{staticClass:"message"},[n("span",{staticClass:"from"},[e._v(e._s(t.from)+":")]),n("span",{staticClass:"content"},[e._v(e._s(t.message))])])}))])]):e._e()},h=[],g=(n("91GP"),n("f3/d"),n("pIFo"),n("ls82"),n("MECJ")),w=n("je13"),y=n.n(w),b=n("g+FG"),O=n.n(b),x=n("cymD"),_=n.n(x),k=n("6lFo"),j=n.n(k),C=n("rpcZ"),S="GiifLqhSM1zEWHYN",$=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:81;e=S+e;for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZ9",r=[],o=C(e),s=0;s<t;s++){var i=Math.round(o()*n.length);r.push(n[i%n.length])}return r.join("")},E=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},T=function(e){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e):new Promise(function(t,n){var r=navigator.getUserMedia||navigator.webkitGetUserMedia;r||n(new Error("Browser unsupported")),r.call(navigator,e,t,n)})},U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("window",[n("h2",[e._v("Share this link!")]),n("div",{staticClass:"inner"},[n("p",[e._v("\n      People will be able to call you with this link while you keep this tab open.\n    ")]),n("b",[e._v("Beta notice:")]),e._v(" Tested on Chrome on desktop and Android, with iOS only Safari has WebRTC, but we weren't able to get it to work with ION at the moment.\n    "),n("br"),n("br"),n("text-input",{ref:"urlField",nativeOn:{click:function(t){return e.onUrlClick(t)}},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}})],1)])},F=[],N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ion-input"},[n("div",{staticClass:"wrapper"},[n("input",{ref:"inputField",attrs:{placeholder:e.placeholder,type:"text"},domProps:{value:e.value},on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.onEnter(t):null},input:e.updateInput}})])])},J=[],L={props:["placeholder","value","onEnter"],methods:{updateInput:function(e){this.$emit("input",e.currentTarget.value)}}},P=L,M=(n("OohY"),Object(f["a"])(P,N,J,!1,null,"432e9b6d",null)),I=M.exports,R={props:["url"],components:{TextInput:I,Window:m},mounted:function(){this.$refs.urlField.$refs.inputField.readOnly=!0},methods:{onUrlClick:function(e){var t=this.$refs.urlField.$refs.inputField;t.select()}}},B=R,D=(n("XBu6"),Object(f["a"])(B,U,F,!1,null,"4eb6bade",null)),V=D.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:"zoom"},on:{"after-enter":function(t){e.onUpdate()}}},[n("div",{staticClass:"user-video"},[n("div",{staticClass:"tooltip vue-tooltip-theme",staticStyle:{position:"absolute","will-change":"transform",top:"-50px",left:"50%","margin-left":"-60px",width:"120px"},attrs:{role:"tooltip","aria-hidden":"false","x-placement":"top"}},[n("div",{staticClass:"tooltip-arrow",staticStyle:{left:"50px"}}),n("div",{staticClass:"tooltip-inner",staticStyle:{"text-align":"center"}},[e._v(e._s(e.name))])]),n("div",{staticClass:"inner"},["connected"!==e.status?n("div",{staticClass:"vid-status"},[n("atom-spinner",{attrs:{color:"#90abad",size:90}})],1):e._e(),n("div",{directives:[{name:"show",rawName:"v-show",value:"connected"===e.status,expression:"status === 'connected'"}]},[e._t("default")],2)])])])},K=[],G=n("RYOR"),X={props:["name","status","onUpdate"],components:{AtomSpinner:G["a"]}},z=X,W=(n("OBwG"),Object(f["a"])(z,H,K,!1,null,"69997442",null)),q=W.exports,A=j.a.utils.Peer,Q={components:{UserVideo:q,ShareWindow:V,TextInput:I},beforeDestroy:function(){null!==this.ion&&(console.warn("Destroyed ION"),this.ion.stop(),this.ion=null)},mounted:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.$route.params.seed,$(t),!this.$route.params.myTag){e.next=17;break}if(this.correctlyLoaded=!0,this.loadUser(),!this.user){e.next=15;break}return this.myTag=this.$route.params.myTag,console.log("Call using ION ".concat(j.a.version)),e.next=10,T({video:!0,audio:!0});case 10:this.myStream=e.sent,this.$refs.my_vid.srcObject=this.myStream,this.$refs.my_vid.volume=0,this.$refs.my_vid.play(),this.connect();case 15:e.next=18;break;case 17:this.$router.replace({name:"call-tag",params:{seed:t,myTag:j.a.utils.randomTag()}});case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),methods:{loadUser:function(){this.user=y.a.get("user")},say:function(){var e={from:this.user.name,message:this.message},t=JSON.stringify(e);this.ion.broadcast("msg:"+t),this.messages.unshift(e),this.message=""},videoUpdated:function(){},getConnectionUrl:function(){return window.location.href.substring(0,window.location.href.indexOf("#"))+"#/"+this.$route.params.seed},connect:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=this,n=new O.a({provider:"https://nodes.testnet.iota.org:443/"}),t.ion=new j.a(n,"xSzG20i5l5kwCHXm",this.$route.params.seed,this.myTag),t.ion.connect({}),t.ion.on("error",function(e){t.status="error",t.error=e}),t.ion.on("connect",function(e){var n="intro:"+JSON.stringify({name:t.user.name});console.log("sending",n,"to",e.user),t.ion.send(e.user,n),console.log("Connected! Upgrading connection to video chat, initiator:",t.ion.peers[e.user].initiator);var r=new A({initiator:t.ion.peers[e.user].initiator,trickle:!0,config:{iceServers:[{urls:"stun:stun.xs4all.nl:3478"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun.vodafone.ro:3478"}]}});t.$set(t.connections,e.user,{peer:r,status:"upgrading"}),r.on("signal",function(n){console.log("signal to ".concat(e.user,":"),JSON.stringify(n)),t.ion.send(e.user,"signal:"+JSON.stringify(n))}),r.on("connect",Object(g["a"])(regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:o=Object.assign({},t.connections[e.user]),o.status="acquiring_stream",t.connections[e.user]=o,r.on("stream",function(n){var r="vid:".concat(e.user);t.$refs[r][0].srcObject=n,t.$refs[r][0].volume=1,t.$refs[r][0].play(),t.currentlyTalking=t.connections[e.user];var o=Object.assign({},t.connections[e.user]);o.status="connected",t.connections[e.user]=o}),r.addStream(t.myStream);case 5:case"end":return n.stop()}},n,this)})))}),t.ion.on("close",function(e){var n=e.user,r=Object.assign({},t.connections),o=r[n];o.peer&&o.peer.destroy(),delete r[n],t.connections=r}),t.ion.on("data",function(e){var n=e.data,r=e.user,o=t.connections[r].peer,s="signal:",i="msg:",a="intro:";if(0===n.indexOf(s))o.signal(n.substring(s.length,n.length));else if(0===n.indexOf(a)){var c=n.substring(a.length,n.length);c=JSON.parse(c);var u=Object.assign({},t.connections[r]);u.name=c.name,t.connections[r]=u}else if(0===n.indexOf(i)){c=n.substring(i.length,n.length);c=JSON.parse(c),t.messages.unshift({message:c.message,from:c.from}),new _.a({text:E("".concat(c.from,": ").concat(c.message)),timeout:2500,progressBar:!0,layout:"bottomCenter"}).show()}});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},data:function(){return{messages:[],ion:null,myTag:null,message:"",error:null,connections:{},myStream:null,currentlyTalking:null,user:null,correctlyLoaded:!1}}},Y=Q,Z=(n("8QEZ"),Object(f["a"])(Y,v,h,!1,null,"72819c45",null)),ee=Z.exports,te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("p",{staticStyle:{"font-weight":"bold"}},[e._v("\n    Hello there! Please set a nickname for other people to see.\n  ")]),n("p",[e._v("\n    Note: This is only stored locally, it won't be stored online anywhere. Only people you will call or people who will call you will be able to see this.\n  ")]),n("text-input",{attrs:{onEnter:e.ok,placeholder:"Enter name here..."},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),n("br"),n("button",{staticClass:"btn-hover color-3",on:{click:function(t){e.ok()}}},[e._v("\n    Let's go!\n  ")])],1)},ne=[],re={props:["onFinish"],methods:{ok:function(){y.a.set("user",{name:this.name}),this.onFinish()}},components:{TextInput:I},data:function(){return{name:""}}},oe=re,se=(n("/ee7"),Object(f["a"])(oe,te,ne,!1,null,"3b04ff5c",null)),ie=se.exports,ae={components:{Window:m,NameInput:ie,Call:ee},methods:{loadUser:function(){this.user=y.a.get("user")},onSetNickname:function(){this.loadUser()}},mounted:function(){this.loadUser()},data:function(){return{user:null}}},ce=ae,ue=(n("0Lli"),Object(f["a"])(ce,i,a,!1,null,null,null)),le=ue.exports;r["a"].use(s["a"]);var de=new s["a"]({routes:[{path:"/:seed",name:"call",component:le},{path:"/:seed/:myTag",name:"call-tag",component:le}]});r["a"].config.productionTip=!1,new r["a"]({router:de,render:function(e){return e(o["default"])}}).$mount("#app")},XBu6:function(e,t,n){"use strict";var r=n("g/FB"),o=n.n(r);o.a},f69V:function(e,t,n){"use strict";var r=n("7aLH"),o=n.n(r);o.a},"g/FB":function(e,t,n){},hS2K:function(e,t,n){},m5jE:function(e,t,n){},rFnw:function(e,t,n){"use strict";var r=n("E47j"),o=n.n(r);o.a},tJJL:function(e,t,n){},xQ6B:function(e,t,n){},ykFD:function(e,t,n){}});
//# sourceMappingURL=app.7644673e.js.map